<%- include('layout', { title: 'Админ панель', user: user }) %>

<div class="admin-container">
    <% if (message) { %>
        <div class="info-message"><%= message %></div>
    <% } %>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Всего пользователей</h3>
            <p class="stat-number"><%= stats.total_users %></p>
        </div>
        <div class="stat-card">
            <h3>Заблокированных</h3>
            <p class="stat-number"><%= stats.blocked_users %></p>
        </div>
        <div class="stat-card">
            <h3>Материалов</h3>
            <p class="stat-number"><%= stats.total_materials %></p>
        </div>
        <div class="stat-card">
            <h3>Сообщений</h3>
            <p class="stat-number"><%= stats.total_messages %></p>
        </div>
    </div>
    
    <div class="admin-section">
        <h2>Управление пользователями</h2>
        
        <div class="users-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Имя пользователя</th>
                        <th>Email</th>
                        <th>Полное имя</th>
                        <th>Дата регистрации</th>
                        <th>Статус</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr class="<%= user.is_blocked ? 'blocked' : '' %>">
                            <td><%= user.id %></td>
                            <td><%= user.username %></td>
                            <td><%= user.email %></td>
                            <td><%= user.full_name || 'Не указано' %></td>
                            <td><%= new Date(user.created_at).toLocaleDateString('ru-RU') %></td>
                            <td>
                                <span class="status <%= user.is_blocked ? 'blocked' : 'active' %>">
                                    <%= user.is_blocked ? 'Заблокирован' : 'Активен' %>
                                </span>
                            </td>
                            <td>
                                <form method="POST" style="display: inline;">
                                    <input type="hidden" name="user_id" value="<%= user.id %>">
                                    <% if (user.is_blocked) { %>
                                        <button type="submit" name="unblock_user" class="btn btn-success btn-sm">
                                            Разблокировать
                                        </button>
                                    <% } else { %>
                                        <button type="submit" name="block_user" class="btn btn-danger btn-sm" 
                                                onclick="return confirm('Вы уверены, что хотите заблокировать этого пользователя?')">
                                            Заблокировать
                                        </button>
                                    <% } %>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>